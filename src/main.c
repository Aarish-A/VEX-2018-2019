#pragma config(Sensor, in8,    anglerPoti,     sensorPotentiometer)
#pragma config(Motor,  port2,           angler,        tmotorVex393TurboSpeed_MC29, openLoop, reversed)
#pragma config(Motor,  port3,           intake,        tmotorVex393TurboSpeed_MC29, openLoop)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

#define LIM_TO_VAL(input, val) (abs(input) > (val) ? (val) * sgn(input) : (input))

// Year-independent libraries (headers)
#include "joysticks.h"

// Year-independent libraries (source)
#include "joysticks.c"

// Other includes
//#include "Vex_Competition_Includes_Custom.c"
#include "controls.h"

// Subsystems (headers)
#include "angler.h"
#include "intake.h"

// Subsystems (source)
#include "angler.c"
#include "intake.c"

void startTasks()
{
	startTask(handleAngler);
	startTask(handleIntake);
}

void stopTasks()
{
	stopAllTasks();
}

void startup()
{
	clearDebugStream();
	setupJoysticks();

	//Setup Joysticks & Buttons
	enableJoystick(BTN_ANGLER_UP);
	enableJoystick(BTN_ANGLER_DOWN);
	enableJoystick(BTN_INTAKE_IN);
	enableJoystick(BTN_INTAKE_OUT);

	gJoy[JOY_THROTTLE].deadzone = 15;
	gJoy[JOY_TURN].deadzone = 15;
}

void update()
{
	hogCPU();
	updateJoysticks();
	releaseCPU();
}

task main()
{
	startup();
	startTasks();

	while(true)
	{
		update();
		sleep(10);
	}

	stopTasks();
}



//task usercontrol()
//{
//	sCycleData cycle;
//	initCycle(cycle, 10, "usercontrol");

//	writeDebugStreamLine("%d Start usercontrol",npgmtime);
//	startTasks();

//	while (true)
//	{
//		updateJoysticks();
//		updateMotors();
//		updateSensorInputs();
//		updateSensorOutputs();

//		handleDrive();
//		handleIntake();
//		handleShooter();

//		shooterSafety();

//		//setMobileState();

//		endCycle(cycle);
//	}
//	stopTasks();
//}

//task autonomous()
//{
//	tStart(autoMotorSensorUpdateTask);
//	startTasks();
//	writeDebugStreamLine("%d Start Autonomous, %d", npgmtime, nBatteryLevel);

//	startTasks();
//	sleep(100);
//	writeDebugStreamLine("%d Starting", npgmtime);
//	//shooterStateChange(shooterReload);

//	sCycleData cycle;
//	initCycle(cycle, 10, "auto");
//	while(true)
//	{
//		endCycle(cycle);
//	}
//	stopTasks();
//	tStop(autoMotorSensorUpdateTask);
//	stopTasks();
//}
