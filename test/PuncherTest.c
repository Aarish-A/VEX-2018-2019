#pragma config(Sensor, dgtl2,  enc,            sensorQuadEncoder)
#pragma config(Motor,  port2,           mtr,           tmotorVex393_MC29, openLoop)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//
#define GEAR_RATIO (5/3)
#define RELOAD_VAL 360.0*(5.0/(float)3.0)

task printBttn()
{
	while (true)
	{
		bool button = vexRT[Btn6U];

		datalogDataGroupStart();
		datalogAddValueWithTimeStamp(1, button);
		datalogDataGroupEnd();

		sleep(10);
	}
}

task main()
{
	startTask(printBttn);

	sensorValue[enc] = 0;
	const int startVal = sensorValue[enc];
	int shotCount = 0;

	bool button, lstButton;
	writeDebugStreamLine("start");
	while (true)
	{
		button = vexRT[Btn6U];

		if (button && !lstButton)
		{
			writeDebugStreamLine("%d button push", npgmtime);
			motor[mtr] = 127;
			shotCount++;

			float target = shotCount * RELOAD_VAL;
			writeDebugStreamLine("Start loop %f", target);
			while( abs(SensorValue[enc] - startVal) < target )
			{
				writeDebugStreamLine("%d sC:%d, targ:%f, Sensor:%d", nPgmTime, shotCount, target, SensorValue[enc]);
				sleep(10);
			}

			motor[mtr] = 0;
		}

		lstButton = button;
		sleep(10);
	}

	stopTask(printBttn);
}
